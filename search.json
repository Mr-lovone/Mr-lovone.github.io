[{"title":"hexoæŠ˜è…¾è®°å½•â€”â€”hexoæ¡†æ¶+butterflyä¸»é¢˜+Qexoå¯è§†åŒ–åå°","url":"/posts/c11e20be/","content":"\nç†æƒ³ä¸­çš„åšå®¢ï¼š\n\nå…¨ç¨‹å…è´¹&#x2F;æå°‘æ”¶è´¹é¡¹ç›®\nç¾è§‚\nå†™æ–‡ç« å’Œæ¨é€æ“ä½œç®€å•\n\n\n\nç†æƒ³ä¸­çš„æ“ä½œè¿‡ç¨‹ï¼š\n\nä½¿ç”¨ç”µè„‘æˆ–è€…æ‰‹æœºæ‰“å¼€åå°ç®¡ç†\nç¼–å†™æ–‡ç« \nå°†æ–‡ç« å‘å¸ƒåˆ°åšå®¢\n\n\nå®é™…ä¸Šï¼Œå¦‚æœä½ åªæ˜¯ç®€å•åœ°ä½¿ç”¨ hexo +ä¸€äº›ä¸»é¢˜ï¼Œå¹¶ä¸èƒ½åšåˆ°ä¸Šé¢çš„éšæ—¶éšåœ°ç¼–å†™æ–‡ç« ï¼Œå› ä¸ºä»–éœ€è¦æˆ‘ä»¬ç»å¸¸æ€§åœ°æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤ï¼Œè¿™éå¸¸ä¸ä¼˜é›…ã€‚å¦‚æœä½ æƒ³éšæ—¶éšåœ°åŠæ—¶åœ°ç¼–å†™åšå®¢ï¼Œå°‘æ•²å‘½ä»¤ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç»§ç»­çœ‹ä¸‹å»äº†ã€‚\n\nå‰æœŸç¯å¢ƒå‡†å¤‡\nä»»æ„å¹³å°å®‰è£…å³å¯ï¼Œæˆ‘æ˜¯åœ¨ windows ä¸­å®‰è£…çš„ã€‚\n\nnodejs å®‰è£…å‚è€ƒé“¾æ¥ï¼šNode.js å®‰è£…é…ç½® | èœé¸Ÿæ•™ç¨‹\n\nPSï¼š æˆ‘ä½¿ç”¨çš„æ˜¯ v22.20.0\n\néªŒè¯ï¼š\n\nC:\\Users\\lovone&gt;node â€“version\nv22.20.0C:\\Users\\lovone&gt;npm -v\n10.9.3\n\nå‡ºç°ç‰ˆæœ¬å·è¯´æ˜å®‰è£…æˆåŠŸã€‚\ngit å®‰è£…å‚è€ƒé“¾æ¥ï¼šGit å®‰è£…é…ç½® | èœé¸Ÿæ•™ç¨‹\néªŒè¯ï¼š\n\nC:\\Users\\lovone&gt;git -h\nusage: gitâ€¦â€¦\n\næ­å»º hexo\næ³¨æ„ï¼šæœ¬æ–‡ä¸­ï¼Œåç»­æ‰€æœ‰çš„å‘½ä»¤éƒ½æ˜¯åœ¨ Git Bash ä¸­æ•²çš„ã€‚\n\næ‹‰å– hexo\næ³¨æ„ï¼šå¦‚æœ npm æ‹‰å–é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œè¯·è‡ªè¡Œæ›´æ¢ä¸ºå›½å†…æº\n\nnpm install hexo-cli -g\n\nåˆ›å»ºæœ¬åœ°ç¯å¢ƒåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç”¨åšhexoçš„æ ¹ç›®å½•å¹¶åˆå§‹åŒ–\n# åˆ›å»ºhexoæ–‡ä»¶å¤¹mkdir hexo# è¿›å…¥è¯¥æ–‡ä»¶å¤¹cd hexo# hexoåˆå§‹åŒ–hexo init# å®‰è£…å¿…è¦çš„åº“npm install# ç”Ÿæˆhexoçš„é™æ€ç½‘é¡µhexo g# æœ¬åœ°æµ‹è¯•hexo s\n\næ­¤æ—¶ä¼šåœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ªä¸´æ—¶æœåŠ¡å™¨ä¾›ç”¨æˆ·é¢„è§ˆï¼Œç‚¹å‡»æç¤ºé“¾æ¥ http://localhost:4000/è®¿é—®ã€‚\n\nåˆ›å»º github pages ä»“åº“åœ¨githubä¸Šåˆ›å»ºä¸€ä¸ªå…¬æœ‰ä»“åº“ ï¼Œç”¨æ¥å­˜æ”¾åšå®¢é™æ€æ–‡ä»¶ã€‚æ³¨æ„ ï¼š\n\nè¯¥ä»“åº“å¿…é¡»æ˜¯å…¬æœ‰ä»“åº“ï¼ˆpublicï¼‰\nè¯¥ä»“åº“çš„åå­—å¿…é¡»ä¸º [ä½ çš„ github ç”¨æˆ·å].github.io\n\n\nç„¶ååœ¨è¯¥ä»“åº“ä¸­ï¼Œç‚¹å‡» Settings -&gt; Pagesï¼ŒæŒ‰ç…§å¦‚å›¾é…ç½®å³å¯ã€‚\n\nåŸŸåè§£æçš„é¢˜å¤–è¯å¦‚æœä½ åœ¨å›½å†…å·²ç»æœ‰äº†åŸŸåï¼Œæ— è®ºæ˜¯å¦å¤‡æ¡ˆäº†ï¼Œéƒ½å¯ä»¥è§£æåˆ° github pagesã€‚åªéœ€è¦åœ¨ä¸Šé¢çš„ Custom domain ä¸­å¡«å†™ä½ çš„åŸŸåå³å¯ã€‚ï¼ˆè¿™é‡Œæœ‰ç‚¹è®°ä¸æ¸…äº†â€¦â€¦ï¼‰\né…ç½®hexo-deployå®‰è£…hexo-deployå·¥å…·npm install hexo-deployer-git --save\n\nç¼–è¾‘ hexo çš„ _config.yaml æ–‡ä»¶ç¼–è¾‘ hexo çš„ _config.yaml æ–‡ä»¶ï¼Œåœ¨æœ«å°¾çš„deploy å¤„æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæ³¨æ„ï¼šdeploy å­—æ®µåªèƒ½æœ‰ä¸€ä¸ªï¼‰\ndeploy:  type: git  repo: git@github.com:ä½ çš„ç”¨æˆ·å/ä½ çš„ç”¨æˆ·å.github.io  branch: main\n\néƒ¨ç½²åˆ° githubé…ç½®gitgit config --global user.name &quot;ä½ çš„Githubç”¨æˆ·å&quot;git config --global user.email &quot;ä½ çš„Githubé‚®ç®±&quot;\n\nä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹æ˜¯å¦é…ç½®æˆåŠŸã€‚\ngit config get --global user.namegit config get --global user.email\n\nç”Ÿæˆå¯†é’¥cd ~/.ssh/                # åˆ‡æ¢åˆ°ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„.sshæ–‡ä»¶å¤¹ï¼ˆå¦‚æœæ²¡æœ‰ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰ssh-keygen -t ed25519 -C &quot;ä½ çš„é‚®ç®±&quot;  # ä½¿ç”¨ed25519ç®—æ³•ç”Ÿæˆå¯†é’¥å¯¹ï¼Œå¹¶æ·»åŠ é‚®ç®±ä½œä¸ºæ³¨é‡Šcat id_ed25519.pub\t\t\t\t# å¯ä»¥çœ‹åˆ°å› å˜å˜iæ”¾åœ¨githubä¸Šçš„å…¬é’¥\n\nä¸€è·¯å›è½¦ï¼Œç”Ÿæˆçš„keyä¼šä¿å­˜åœ¨ä½ çš„ç”¨æˆ·æ–‡ä»¶å¤¹ä¸­çš„ .sshæ–‡ä»¶å¤¹ä¸‹ï¼Œå…¬é’¥ä¸º id_ed25519.pubçš„æ–‡ä»¶ã€‚æ¥ä¸‹æ¥ç™»å½•Githubï¼Œåœ¨ Settings -&gt; SSH and GPG keys -&gt; new SSH keysé€‰æ‹© Authentication Keyä¸Šä¼ å…¬é’¥å†…å®¹ã€‚\næµ‹è¯•è¿æ¥ssh -T git@github.com\n\n\nHi ã€ä½ çš„ github ç”¨æˆ·åã€‘! Youâ€™ve successfully authenticated, but GitHub does not provide shell access.\n\nå‡ºç°ä¸Šé¢çš„å†…å®¹ï¼Œè¯´æ˜å·²ç»æˆåŠŸäº†ã€‚\næµ‹è¯•éƒ¨ç½² hexo çš„é™æ€ç½‘ç«™hexo g &amp;&amp; hexo d\n\næ­¤æ—¶ï¼Œä½ åº”è¯¥å¯ä»¥è®¿é—® https://ä½ çš„ github ç”¨æˆ·å.github.io æ¥è®¿é—®åˆ°ä½ çš„åšå®¢ä¸»é¡µäº†ã€‚\nå®‰è£…ä¸»é¢˜ butterfly\nhexo ç¤¾åŒºç»´æŠ¤ç€å¤§é‡çš„ä¸»é¢˜åŒ…ï¼Œæ­¤å¤„ä»…ä»‹ç» Butterfly ï¼Œå…¶ä½™ä¸»é¢˜è¯·è‡ªè¡Œå®‰è£…å’Œé…ç½®\n\nå…‹éš†ä¸»é¢˜ butterflyåœ¨hexoç›®å½•ä¸‹è¾“å…¥ä»¥ä¸‹å‘½ä»¤\ngit clone -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly\n\nå®‰è£… pug å’Œ stylus çš„æ¸²æŸ“å™¨npm install hexo-renderer-pug hexo-renderer-stylus --save\n\nåº”ç”¨ä¸»é¢˜ä¿®æ”¹ Hexo æ ¹ç›®å½•ä¸‹çš„ _config.ymlï¼ŒæŠŠä¸»é¢˜æ”¹ä¸º butterfly\ntheme: butterfly\n\nå‡çº§å»ºè®®ä¸ºäº†å‡å°‘å‡çº§ä¸»é¢˜åå¸¦æ¥çš„ä¸ä¾¿ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š\nåœ¨ hexo çš„æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ _config.butterfly.ymlï¼Œå¹¶æŠŠç›®å½• themes&#x2F;butterfly ä¸‹çš„ _config.yml å†…å®¹å¤åˆ¶åˆ° _config.butterfly.yml å»ã€‚\n\næ³¨æ„ï¼š\n\nä¸è¦æŠŠä¸»é¢˜ç›®å½• themes&#x2F;butterfly ä¸‹çš„ _config.yml åˆ æ‰ã€‚\nå¤åˆ¶çš„æ˜¯ä¸»é¢˜butterflyçš„ _config.yml ï¼Œè€Œä¸æ˜¯ hexo çš„ _config.yml\nä»¥ååªéœ€è¦åœ¨ _config.butterfly.yml è¿›è¡Œé…ç½®å°±è¡Œã€‚å¦‚æœä½¿ç”¨äº† _config.butterfly.ymlï¼Œ é…ç½®ä¸»é¢˜çš„ _config.yml å°†ä¸ä¼šæœ‰æ•ˆæœã€‚\n\n\nTips: æ­¤æ—¶ä½ å¯ä»¥ä¾æ¬¡æ‰§è¡Œå‘½ä»¤ hexo cleanã€hexo gã€hexo sï¼Œæ ¹æ®æç¤ºé“¾æ¥é¢„è§ˆä¸»é¢˜æ˜¯å¦å·²ç»æ›´æ–°ã€‚\nåˆ©ç”¨ GitHub Actions è¿›è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²åˆ›å»ºè‡ªåŠ¨åŒ–éƒ¨ç½² Actions è„šæœ¬åœ¨ hexo çš„ .githubæ–‡ä»¶å¤¹ä¸‹æ–°å»º workflowsæ–‡ä»¶å¤¹ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹åˆ›å»º main.ymlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nname: Blog CI/CD # è„šæœ¬ workflow åç§°#æµ‹è¯•Actionson:  push:    branches: [main, master] # å½“ç›‘æµ‹ main,master çš„ push    paths: # ç›‘æµ‹æ‰€æœ‰ source ç›®å½•ä¸‹çš„æ–‡ä»¶å˜åŠ¨ï¼Œæ‰€æœ‰ yml,json åç¼€æ–‡ä»¶çš„å˜åŠ¨ã€‚      - &#x27;*.json&#x27;      - &#x27;**.yml&#x27;      - &#x27;**/source/**&#x27;jobs:  blog: # ä»»åŠ¡åç§°    timeout-minutes: 30 # è®¾ç½® 30 åˆ†é’Ÿè¶…æ—¶    runs-on: ubuntu-latest # æŒ‡å®šæœ€æ–° ubuntu ç³»ç»Ÿ    steps:      - name: Checkout code with submodules        uses: actions/checkout@v4        with:          token: $&#123;&#123; secrets.GITHUB_TOKEN &#125;&#125;          fetch-depth: 1          submodules: false  # âœ…âœ… å…³é”®ï¼šä½¿ç”¨è‡ªå®šä¹‰çš„butterflyä¸»é¢˜ï¼Œè¯¥å‚æ•°å¿…é¡»ä¸ºfalseã€‚å¦åˆ™éœ€è¦ä¸ºtrue        - uses: actions/setup-node@v4 # è®¾ç½® node.js ç¯å¢ƒ      - name: Cache node_modules # ç¼“å­˜ node_modulesï¼Œæé«˜ç¼–è¯‘é€Ÿåº¦ï¼Œæ¯•ç«Ÿæ¯æœˆåªæœ‰ 2000 åˆ†é’Ÿã€‚        uses: actions/cache@v4 # äº²æµ‹ Github æœåŠ¡å™¨ç¼–è¯‘é€Ÿåº¦æ¯”æˆ‘è‡ªå·±ç”µè„‘éƒ½å¿«ï¼Œå¦‚æœæ¯æ¬¡æ„å»ºæŒ‰5åˆ†é’Ÿè®¡ç®—ï¼Œæˆ‘ä»¬æ¯ä¸ªæœˆå¯ä»¥å…è´¹éƒ¨ç½² 400 æ¬¡ï¼ŒGithub yydsï¼ï¼ï¼        env:          cache-name: cache-node-modules        with:          path: ~/.npm          key: $&#123;&#123; runner.os &#125;&#125;-build-$&#123;&#123; env.cache-name &#125;&#125;-$&#123;&#123; hashFiles(&#x27;**/package-lock.json&#x27;) &#125;&#125;          restore-keys: |            $&#123;&#123; runner.os &#125;&#125;-build-$&#123;&#123; env.cache-name &#125;&#125;-            $&#123;&#123; runner.os &#125;&#125;-build-            $&#123;&#123; runner.os &#125;&#125;-      - name: Init Node.js # å®‰è£…æºä»£ç æ‰€éœ€æ’ä»¶        run: |          npm install          echo &quot;init node successful&quot;      - name: Install Hexo-cli And component # å®‰è£… Hexo        run: |          npm install -g hexo-cli --save          npm install hexo-generator-sitemap --save          npm install hexo-generator-baidu-sitemap --save          npm install hexo-abbrlink --save          npm install hexo-renderer-pug hexo-renderer-stylus --save          npm i hexo-renderer-markdown-it --save          npm install hexo-generator-searchdb          npm install katex @renbaoshuo/markdown-it-katex          npm install hexo-wordcount --save          npm i hexo-filter-nofollow --save          npm install hexo-generator-feed --save          # ğŸ””æ³¨æ„ï¼šå¦‚æœåæœŸè¿˜éœ€è¦å¢åŠ å…¶ä»–çš„æ’ä»¶ï¼Œè®°å¾—åœ¨è¿™é‡Œè¿›è¡Œæ·»åŠ           echo &quot;install hexo successful&quot;      - name: Build Blog # ç¼–è¯‘åˆ›å»ºé™æ€åšå®¢æ–‡ä»¶        run: |          hexo clean &amp;&amp; hexo g          echo &quot;build blog successful&quot;      - name: Deploy Blog # è®¾ç½® git ä¿¡æ¯å¹¶æ¨é€é™æ€åšå®¢æ–‡ä»¶        run: |          cd ./public          git init          git config user.name &quot;$&#123;&#123;secrets.GIT_NAME&#125;&#125;&quot;          git config user.email &quot;$&#123;&#123;secrets.GIT_EMAIL&#125;&#125;&quot;          git add .          git commit -m &quot;Update&quot;          git push --force --quiet &quot;https://$&#123;&#123;secrets.GH_TOKEN&#125;&#125;@$&#123;&#123;secrets.GH_REF&#125;&#125;&quot; master:main      - run: echo &quot;Deploy Successful!&quot;\n\nğŸ”” æ³¨æ„ï¼šå¦‚æœåæœŸè¿˜éœ€è¦å¢åŠ å…¶ä»–çš„æ’ä»¶ï¼Œè®°å¾—åœ¨ 50 è¡Œå‰åè¿›è¡Œæ·»åŠ \né…ç½®ç§æœ‰ä»“åº“ Blog-Sourceè¿™é‡Œå®é™…ä¸Šåœ¨é…ç½®åšå®¢çš„æºç ä»“åº“ã€‚åç»­æˆ‘ä»¬çš„ Qexo æ—¶ç›´æ¥æ“ä½œè¿™ä¸ªæºç ä»“åº“ï¼Œåœ¨æˆ‘ä»¬å¢åŠ æˆ–ä¿®æ”¹åï¼ŒGitHub Actions ä¼šç›‘æµ‹åˆ°ä»“åº“çš„ä¿®æ”¹ï¼Œç„¶å Actions ä¼šè‡ªåŠ¨æ‰§è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼Œè€Œè‡ªåŠ¨æ‰§è¡Œçš„è¿™äº›æ“ä½œæˆ‘ä»¬æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ github çš„Actions é‡æ–°ç”Ÿæˆæˆ‘ä»¬çš„åšå®¢å¹¶ä¸”è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ° github.ioã€‚\n\nå¯ä»¥ä¸å«Blog-Sourceï¼Œæ”¹æˆå…¶ä»–åç§°ä¹Ÿè¡Œã€‚\n\næ–°å»ºç§æœ‰ä»“åº“ Blog-Sourceå¦‚å›¾\n\nè¿æ¥ç§æœ‰ä»“åº“ Blog-Sourceç”±äºä¸Šé¢æˆ‘ä»¬è¿æ¥çš„æ˜¯ github.io çš„ä»“åº“ï¼Œç°åœ¨éœ€è¦å°†æºç æ¨é€åˆ°Blog-Sourceï¼Œå› æ­¤éœ€è¦ä¿®æ”¹è¿æ¥ä»“åº“çš„åå­—ã€‚\ngit remote set-url origin https://github.com/ä½ çš„ç”¨æˆ·å/Blog-Source.git\n\né…ç½®ç§æœ‰ä»“åº“çš„ Secretã€‚åœ¨Actions è„šæœ¬ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†å››ä¸ªå˜é‡ï¼ŒGIT_NAME, GIT_EMAIL, GH_TOKEN,GH_REFï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç§æœ‰ä»“åº“ Blog-Source ä¸­é…ç½®å®ƒä»¬ã€‚åœ¨ Blog-Source -&gt; Settings -&gt; Secrets and variables -&gt; Actions -&gt; Secrets ä¸­æ·»åŠ ç”¨äºGithub Actionçš„Secretsã€‚\n\n\nGIT_NAMEçš„å°±æ˜¯Githubè´¦å·çš„ç”¨æˆ·å\nGIT_EMAILå°±æ˜¯Githubè´¦å·æ‰€ä½¿ç”¨çš„é‚®ç®±\nGH_REF çš„å†…å®¹ä¸º github.com/ç”¨æˆ·å/ç”¨æˆ·å.github.io.git\nGH_TOKENéœ€è¦åœ¨ Github -&gt; Settings -&gt; Developer Settings -&gt; Personal Access tokens -&gt; Tokens(classic) è·å–ï¼Œé€‰æ‹©ç”Ÿæˆ classicç±»å‹çš„tokenï¼Œä¸ºäº†ç®€ä¾¿å¯ä»¥æŠŠtokenè¿‡æœŸæ—¶é—´è®¾ç½®ä¸º æ°¸ä¸è¿‡æœŸï¼Œæƒé™èŒƒå›´å‹¾é€‰repoå’Œworkflow\n\n\nç§»é™¤ butterfly çš„å­æ¨¡å—å±æ€§(å¯é€‰)\næ³¨æ„ï¼šç§»é™¤ butterfly çš„å­æ¨¡å—å±æ€§ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬åé¢é­”æ”¹ butterfly ä¸»é¢˜ï¼Œå¦‚æœä½ ä¸éœ€è¦é­”æ”¹ butterflyï¼Œé‚£ä¹ˆè¯·çœ‹ç¬¬ 4.4 æ­¥ã€‚PSï¼š æœ¬äººä½¿ç”¨çš„æ˜¯ 4.3 æ­¥éª¤ã€‚\n\nè¿™é‡Œéœ€è¦è§£é‡Šä¸€ä¸‹è¿™ä¸€æ­¥ï¼šæœªæ¥æˆ‘ä»¬éœ€è¦å°† hexo æ–‡ä»¶å¤¹æ¨é€åˆ° github çš„ Blog-Source ä»“åº“ï¼Œè€Œæˆ‘ä»¬æ˜¯ä½¿ç”¨ git å®‰è£…çš„Butterfly ä¸»é¢˜ï¼Œè¿™ä¼šå¯¼è‡´ Butterfly ä¸»é¢˜è¢«ä½œä¸º Git å­æ¨¡å—å¼•å…¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¿®æ”¹æœ¬åœ°çš„ Butterfly ä¸»é¢˜ä¸ä¼šè¢«åŒæ­¥åˆ° githubï¼Œå› ä¸ºå­æ¨¡å—çš„ä¿®æ”¹é»˜è®¤ä¸ä¼šè¢«ä¸»ä»“åº“è·Ÿè¸ªå’Œéƒ¨ç½²ï¼Œå› æ­¤è¿™é‡Œéœ€è¦ç§»é™¤å®ƒçš„å­—æ¨¡å—å±æ€§ã€‚\n# ç§»é™¤å­æ¨¡å—è®°å½•ï¼ˆä¸åˆ é™¤æ–‡ä»¶ï¼‰git rm --cached themes/butterflyrm -rf .git/modules/themes/butterfly# åˆ é™¤å­æ¨¡å—é…ç½®æ–‡ä»¶ä¸­çš„è®°å½•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰# ç¼–è¾‘ .gitmodules æ–‡ä»¶ï¼Œåˆ é™¤å…³äº themes/butterfly çš„æ®µè½ï¼Œç„¶åä¿å­˜# å°†ä¿®æ”¹åçš„ä¸»é¢˜ç›®å½•æ·»åŠ åˆ°ä¸»ä»“åº“# git add themes/butterflygit add .git commit -m &quot;å°†ä¸»é¢˜butterflyç›®å½•æ·»åŠ åˆ°ä»“åº“ä¸­&quot;git push origin main\n\næ‰§è¡Œå®Œè¿™ä¸€æ­¥åï¼Œä½ å¯ä»¥åœ¨ Blog-Source çš„ Actions æ ‡ç­¾ä¸‹çœ‹åˆ°æ‰§è¡Œçš„è¿‡ç¨‹ã€‚\n\nç­‰å¾…å®ƒæ‰§è¡Œå®Œæ¯•åï¼Œå°±å¯ä»¥è®¿é—® https://ç”¨æˆ·å.github.ioçœ‹åˆ°è‡ªå·±çš„åšå®¢ä¹ŸåŒæ­¥æ›´æ–°äº†ã€‚\nå°† butterfly ä½œä¸ºå­æ¨¡å—(å¯é€‰)\næ³¨æ„ï¼š4.3 å’Œ 4.4 äºŒé€‰å…¶ä¸€å³å¯ã€‚**å¦‚æœä½ ä¸ç¡®å®šä½¿ç”¨å“ªä¸ªï¼Œé‚£ä¹ˆè¯· å’Œæˆ‘ä¸€æ ·é€‰æ‹© 4.3ã€‚**æŒ‰ç…§æˆ‘çš„æ­¥éª¤ä¸€æ­¥ä¸€æ­¥æ¥ã€‚\nå¦‚æœä½ é€‰æ‹©çš„æ˜¯ 4.4ï¼Œé‚£ä¹ˆè®°å¾—ä¿®æ”¹ 4.1 ä¸­çš„ Actions è„šæœ¬ï¼Œå°† submodules: falseä¿®æ”¹ä¸º submodules: true\n\nåœ¨ hexo ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªæ–‡ä»¶ .gitmodules\nå†…å®¹å¦‚ä¸‹ï¼šå®ƒçš„æ„æ€å°±æ˜¯å°†ä¸»é¢˜butterfly ä½œä¸º Git çš„å­æ¨¡å—å¼•å…¥ï¼Œåç»­æ¯æ¬¡æ‰§è¡Œ Action è„šæœ¬æ—¶ï¼Œä¼šè‡ªåŠ¨ä» github æ‹‰å–æœ€æ–°çš„ butterfly ä¸»é¢˜ã€‚\n[submodule &quot;themes/butterfly&quot;]  path = themes/butterfly  url = https://github.com/jerryc127/hexo-theme-butterfly.git\n\néƒ¨ç½² Qexoå…·ä½“éƒ¨ç½²æ–¹æ³•ä¸å†èµ˜è¿°ï¼Œè¯¦æƒ…æŸ¥çœ‹Qexo æ–‡æ¡£ - éƒ¨ç½²\næœ¬äººç›´æ¥åœ¨å…¬ç½‘çš„ vps ä¸Šå®‰è£…äº† dockerï¼Œåˆ©ç”¨ docker å®‰è£…äº† Qexoã€‚åœ¨å“ªé‡Œé…ç½®éƒ½æ— æ‰€è°“ï¼ŒæˆåŠŸäº†å°±è¡Œã€‚\n\n\nè¿™ä¸ª Github å¯†é’¥ å°±æ˜¯Blog-Sourceä¸­çš„GH_TOKENï¼Œå¦‚æœå¿˜è®°äº†å°±å†ç”Ÿæˆä¸€ä¸ªã€‚\nGithub ä»“åº“æ˜¯ Blog-Source\né¡¹ç›®åˆ†æ”¯æ˜¯ main (ä¸ç¡®å®šå°±å» github çœ‹ä¸€ä¸‹ï¼Œä¸€èˆ¬ç°åœ¨é»˜è®¤çš„å°±æ˜¯ main)\nåšå®¢è·¯å¾„ç•™ç©ºå³å¯ã€‚\n\nç„¶åæ­£å¸¸æƒ…å†µä¸‹å°±å¯ä»¥ç™»å½•è¿›å…¥åˆ°åå°äº†ã€‚\n\nQexo çš„ä¸€äº›é…ç½®ç°åœ¨ç›´æ¥ç‚¹å‡»æ–°å»ºæ–‡ç« çš„è¯ï¼Œæ˜¯ä¸èƒ½ä¸Šä¼ å›¾ç‰‡çš„ï¼Œå› ä¸ºæˆªæ­¢åˆ°ç›®å‰ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰è®¾ç½®å›¾åºŠï¼ˆå¯ä»¥ç†è§£ä¸ºå›¾ç‰‡å­˜æ”¾çš„ä½ç½®ï¼‰ã€‚\nå›¾åºŠé…ç½®æ—¢ç„¶å°†å…è´¹è¿›è¡Œåˆ°åº•ï¼Œé‚£æˆ‘ä»¬å°±ç»§ç»­è–… Github çš„ç¾Šæ¯›ï¼Œå°† Github çš„ä»“åº“ä½œä¸ºæˆ‘ä»¬çš„å›¾ç‰‡åº“ã€‚\nåœ¨ Qexo ä¸Šçš„é…ç½®\nè¿™é‡Œè¦æ³¨æ„ï¼š\n\nä¿å­˜è·¯å¾„çš„æœ€å‰é¢æ˜¯ä¸å¸¦ /çš„ã€‚\nè‡ªå®šä¹‰åŸŸåè¿™é‡Œï¼Œç›´æ¥åœ¨åŸŸååé¢è·Ÿ /images/\nè‡³äºå…¶ä»–å‚æ•°çš„å«ä¹‰ï¼Œè¯·å‚è€ƒï¼šQexo æ–‡æ¡£ - å›¾åºŠé…ç½®\n\nåˆ›å»º images æ–‡ä»¶å¤¹ä¿å­˜è·¯å¾„ä¸­ï¼Œæˆ‘ä»¬åªæœ‰ source æ–‡ä»¶å¤¹ï¼Œä½†æ˜¯æ²¡æœ‰ images æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬éœ€è¦æ–°å»ºå®ƒã€‚æœ¬åœ°æ–°å»ºæ–‡ä»¶å¤¹åï¼Œæ”¾å…¥ä¸€å¼ å›¾ç‰‡ï¼Œæ¨é€åˆ°è¿œç¨‹å³å¯ã€‚\n# åœ¨hexoæ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œå‘½ä»¤mkdir source/images# ç”±äºç©ºæ–‡ä»¶å¤¹ä¸ä¼šè¢« Git è·Ÿè¸ªï¼Œæˆ‘ä»¬éœ€è¦æ”¾ä¸€å¼ å›¾ç‰‡è¿›imagesæ–‡ä»¶å¤¹ä¸‹git add .git commit -m &quot;æ–°å¢äº†imagesæ–‡ä»¶å¤¹&quot;git push origin main\n\næµ‹è¯•èƒ½å¦ä¸Šä¼ å›¾ç‰‡å† Qexo ä¸­æ–°å»ºä¸€ç¯‡æ–‡ç« ï¼Œç„¶ååœ¨å›¾ç¤ºçš„åœ°æ–¹ä¸Šä¼ å›¾ç‰‡å³å¯æµ‹è¯•ã€‚\n\nç»“è¯­åˆ°è¿™é‡Œï¼Œè‡ªåŠ¨åŒ–çš„è¿‡ç¨‹åŸºæœ¬å°±æ­å»ºå®Œæ¯•äº†ï¼Œåç»­å°±æ˜¯ç¾åŒ–å’Œé­”æ”¹å·¥ä½œäº†ã€‚\n","categories":["hexo","butterfly","Qexo"],"tags":["hexo","Qexo","Github Actions","æŠ˜è…¾è®°å½•","butterfly"]},{"title":"ä½¿ç”¨Dockerçš„Nginxé•œåƒå°†hexoåšå®¢è¿ç§»åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨å¹¶ä½¿ç”¨Certbotå®ç°è‡ªåŠ¨ç­¾å‘åŠç»­ç­¾Letâ€˜s Encryptå…è´¹SSLè¯ä¹¦","url":"/posts/865fcd4b/","content":"\nåœ¨å¼€å§‹å‰ï¼š\n\nè¯·ç¡®ä¿ä½ é˜¿é‡Œäº‘æœåŠ¡å™¨çš„å®‰å…¨ç»„ä¸­å¼€å¯äº†80ç«¯å£å’Œ443ç«¯å£ã€‚\nç¡®ä¿ä½ å·²ç»æœ‰äº†è‡ªå·±çš„åŸŸåå¹¶å·²ç»è®¾ç½®äº†æ­£å¸¸çš„DNSè§£æåœ°å€ã€‚\n\n\nå®‰è£…Certbotå·¥å…·æ›´æ–°ç³»ç»Ÿï¼Œå®‰è£…å®‰è£…CertbotåŠNginxæ’ä»¶è¿™é‡Œéå¸¸ç®€å•ï¼Œä¸¤è¡Œå‘½ä»¤å°±æå®šäº†ã€‚\n# æ›´æ–°ç³»ç»ŸåŒ…sudo apt update &amp;&amp; sudo apt upgrade -y# å®‰è£…CertbotåŠNginxæ’ä»¶sudo apt install certbot python3-certbot-nginx\n\nè·å–Letâ€™s Encryptè¯ä¹¦Certbotæ”¯æŒå¤šç§è¯ä¹¦è·å–æ¨¡å¼ï¼ŒåŒ…æ‹¬Standaloneæ¨¡å¼ã€Webrootæ¨¡å¼å’ŒDNSéªŒè¯æ¨¡å¼ã€‚ä½¿ç”¨Standaloneæ¨¡å¼è·å–è¯ä¹¦æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œæ— éœ€ç°æœ‰WebæœåŠ¡å™¨è¿è¡Œï¼Œä½†éœ€è¦ä¸´æ—¶å¼€æ”¾80ç«¯å£ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨è¿è¡Œä¸‹é¢å‘½ä»¤å‰ï¼Œä½ éœ€è¦çœ‹ä¸€ä¸‹è‡ªå·±çš„80ç«¯å£ç°åœ¨æœ‰æ²¡æœ‰è¢«å ç”¨ï¼Œå¦‚æœè¢«å ç”¨äº†ï¼Œéœ€è¦åŠæ—¶å°†å ç”¨ç¨‹åºé€€å‡ºï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚\nsudo netstat -tulnp | grep :80\n\n\nç¤ºä¾‹è¾“å‡ºï¼štcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN 1234/nginx â†’ è¿›ç¨‹åæ˜¯ nginx\n\nç„¶åé€€å‡ºå®ƒå°±å¯ä»¥äº†ï¼š\nsudo systemctl stop nginx  # è‹¥æ˜¯ Apacheï¼šsudo systemctl stop apache2\n\nç„¶åè¿è¡Œ Certbot\n# ç¤ºä¾‹ï¼šä½¿ç”¨é‚®ç®±test@lovone.emailä¸ºåŸŸåtest.comç”³è¯·SSLè¯ä¹¦sudo certbot certonly --standalone -d test.com --email test@lovone.email --agree-tos --noninteractive\n\næ­£å¸¸æƒ…å†µä¸‹ä¼šåœ¨ä½ çš„/etc/letsencrypt/live/test.com æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆpemè¯ä¹¦ã€‚\n\né…ç½®è‡ªåŠ¨ç»­ç­¾ä»»åŠ¡Certboté»˜è®¤å®‰è£…åä¼šè‡ªåŠ¨åˆ›å»ºCronå®šæ—¶ä»»åŠ¡ï¼Œå®ç°è¯ä¹¦è‡ªåŠ¨ç»­ç­¾ã€‚éªŒè¯Cronä»»åŠ¡æ˜¯å¦å·²ç”Ÿæˆï¼š\n# æŸ¥çœ‹Certbotçš„Croné…ç½® cat /etc/cron.d/certbot\n\nè¾“å‡ºåº”åŒ…å«ç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š\n\n0 *&#x2F;12 * * * root test -x &#x2F;usr&#x2F;bin&#x2F;certbot -a \\! -d &#x2F;run&#x2F;systemd&#x2F;system &amp;&amp; certbot -q renew\n\næ­¤é…ç½®è¡¨ç¤ºæ¯12å°æ—¶ï¼ˆæ¯å¤©ä¸¤æ¬¡ï¼‰æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸï¼Œå¦‚æœå‰©ä½™æœ‰æ•ˆæœŸå°‘äº30å¤©ï¼Œåˆ™è‡ªåŠ¨ç»­ç­¾.\nå¦‚æœå¸Œæœ›ç¡®ä¿è¯ä¹¦ç»­ç­¾åDockerå®¹å™¨å†…çš„NginxæœåŠ¡èƒ½è‡ªåŠ¨é‡æ–°åŠ è½½é…ç½®ï¼Œéœ€è¦åœ¨Cronå‘½ä»¤ä¸­æ·»åŠ --post-hookå‚æ•°ï¼š\n# ç¼–è¾‘rootç”¨æˆ·çš„Cronä»»åŠ¡ sudo crontab -e  # æ·»åŠ ä»¥ä¸‹è¡Œ 0 */12 * * * certbot renew --post-hook &quot;docker exec lovone-nginx-blog nginx -s reload&quot; &gt; /dev/null 2&gt;&amp;1\n\næ­¤é…ç½®ä¼šåœ¨æ¯12å°æ—¶æ£€æŸ¥ä¸€æ¬¡è¯ä¹¦ï¼Œå¦‚æœéœ€è¦ç»­ç­¾ï¼Œåˆ™æ‰§è¡Œç»­ç­¾æ“ä½œï¼Œå¹¶åœ¨å®Œæˆåé€šè¿‡docker execå‘½ä»¤é‡è½½å®¹å™¨å†…çš„NginxæœåŠ¡ï¼Œä½¿æ–°è¯ä¹¦ç”Ÿæ•ˆã€‚\nåˆ›å»ºDockerfileé…ç½®Nginxå®‰å…¨è®¾ç½®# ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿæºè·å–åŸºç¡€é•œåƒFROM docker.1ms.run/nginx:alpine# éšè—Nginxç‰ˆæœ¬ä¿¡æ¯RUN sed -i &#x27;s/server_tokens on/server_tokens off/&#x27; /etc/nginx/nginx.conf# åˆ é™¤é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œé¿å…å†²çªRUN rm -rf /etc/nginx/conf.d/default.conf# æ·»åŠ è‡ªå®šä¹‰å®‰å…¨é…ç½®COPY nginx.conf /etc/nginx/conf.d/\n\nDockerfileå®ç°äº†ä¸‰ä¸ªå…³é”®çš„å®‰å…¨é…ç½®\n\nä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿæºdocker.1ms.run/nginx:alpineæé«˜é•œåƒæ‹‰å–é€Ÿåº¦\né€šè¿‡sedå‘½ä»¤ä¿®æ”¹Nginxé…ç½®ï¼Œéšè—ç‰ˆæœ¬ä¿¡æ¯ï¼ˆserver_tokens offï¼‰\nåˆ é™¤é»˜è®¤é…ç½®æ–‡ä»¶default.confï¼Œé¿å…ä¸è‡ªå®šä¹‰é…ç½®å†²çª\n\né…ç½®nginx.confserver &#123;    listen 80;    server_name your.domain.cn;# è¿™é‡Œæ›¿æ¢æˆä½ çš„åŸŸå    # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶å’Œéšè—æ–‡ä»¶å¤¹    location ~^\\.(git|env|log) &#123;        deny all;        return 403;    &#125;    # æ‰€æœ‰HTTPè¯·æ±‚é‡å®šå‘åˆ°HTTPS    location / &#123;        return 301 https://$host$request_uri;    &#125;&#125;server &#123;    listen 443 ssl;    server_name your.domain.cn;# è¿™é‡Œæ›¿æ¢æˆä½ çš„åŸŸå    # éšè—Nginxç‰ˆæœ¬ä¿¡æ¯    server_tokens off;    # ç¦ç”¨ç›®å½•åˆ—è¡¨    autoindex off;    # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶å’Œéšè—æ–‡ä»¶å¤¹    location ~^\\.(git|env|log) &#123;        deny all;        return 403;    &#125;    # SSLè¯ä¹¦é…ç½®    ssl_certificate /etc/letsencrypt/live/your.domain.cn/fullchain.pem;    ssl_certificate_key /etc/letsencrypt/live/your.domain.cn/privkey.pem;    # SSLå®‰å…¨å‚æ•°    ssl_protocols TLSv1.2 TLSv1.3;    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;    ssl_prefer_server_ciphers on;    # é™æ€æ–‡ä»¶é…ç½®    root /usr/share/nginx/html;    index index.html index.htm;    # æ—¥å¿—é…ç½®    access_log /var/log/nginx/access.log;    error_log /var/log/nginx/error.log;&#125;\n\né…ç½®æ–‡ä»¶å®ç°äº†åŸºæœ¬çš„å®‰å…¨è¦æ±‚\n\néšè—Nginxç‰ˆæœ¬ä¿¡æ¯ï¼ˆserver_tokens offï¼‰\nç¦æ­¢è®¿é—®ä»¥ç‚¹å¼€å¤´çš„éšè—æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼ˆlocation ~^\\.(git|env|log)è§„åˆ™ï¼‰\nç¦ç”¨ç›®å½•åˆ—è¡¨ï¼ˆautoindex offï¼‰\nåœ¨HTTPç«¯å£ï¼ˆ80ï¼‰ä¸Šå°†æ‰€æœ‰è¯·æ±‚é‡å®šå‘åˆ°HTTPS\né…ç½®SSLè¯ä¹¦è·¯å¾„å’Œå®‰å…¨å‚æ•°\n\nç¼–å†™docker-compose.ymlæ¥ä¸‹æ¥åˆ›å»ºdocker-compose.ymlæ–‡ä»¶ï¼Œå®šä¹‰NginxæœåŠ¡å¹¶é…ç½®å·æŒ‚è½½ï¼Œç¡®ä¿è¯ä¹¦å’Œåšå®¢æºç å¯ä»¥è®¿é—®ï¼š\nversion: &#x27;3.8&#x27;services:  nginx:    image: lovone-blog:latest    container_name: lovone-nginx-blog    ports:      - &quot;80:80&quot;      - &quot;443:443&quot;    volumes:      - /root/web/ç½‘ç«™é™æ€æ–‡ä»¶çš„ç›®å½•:/usr/share/nginx/html      - /etc/letsencrypt:/etc/letsencrypt    restart: unless-stopped    command: nginx -g &quot;daemon off;&quot;\n\ndocker-compose.ymlæ–‡ä»¶å®ç°äº†å…³é”®çš„å·æŒ‚è½½åŠŸèƒ½\n\nå°†ç‰©ç†æœºä¸Šçš„åšå®¢æºç ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„/usr/share/nginx/htmlç›®å½•\nå°†ç‰©ç†æœºä¸Šçš„Letâ€™s Encryptè¯ä¹¦ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„/etc/letsencryptç›®å½•\n\né€šè¿‡è¿™ç§æŒ‚è½½æ–¹å¼ï¼Œå®¹å™¨å†…çš„Nginxå¯ä»¥è®¿é—®æœ€æ–°çš„åšå®¢å†…å®¹å’Œè¯ä¹¦ï¼Œæ— éœ€é‡æ–°æ„å»ºé•œåƒå³å¯æ›´æ–°ã€‚Certbotåœ¨ç‰©ç†æœºä¸Šè·å–å’Œç»­ç­¾çš„è¯ä¹¦ä¼šè‡ªåŠ¨åŒæ­¥åˆ°å®¹å™¨ä¸­ã€‚\næ„å»ºè‡ªå®šä¹‰Nginxé•œåƒå¹¶å¯åŠ¨æœåŠ¡# æ„å»ºé•œåƒ docker build -t lovone-nginx:latest .  # åˆ›å»ºè¯ä¹¦å­˜å‚¨ç›®å½•ï¼ˆå¦‚æœå°šæœªåˆ›å»ºï¼‰ mkdir -p /etc/letsencrypt  # å¯åŠ¨NginxæœåŠ¡ docker compose up -d\n\næ­¤æ—¶ä½ åœ¨æµè§ˆå™¨ä¸­è®¿é—®test.comï¼Œæµè§ˆå™¨ä¼šå…ˆè®¿é—®http://test.com ï¼Œéšåè·³è½¬åˆ°https://test.comï¼Œè¡¨ç¤ºæ­¤æ—¶å·²æˆåŠŸé…ç½®å¥½SSLè¯ä¹¦ã€‚\n\nç»´æŠ¤ä¸å‡çº§éšç€åšå®¢å†…å®¹çš„æ›´æ–°å’ŒNginxé…ç½®çš„è°ƒæ•´ï¼Œéœ€è¦å®šæœŸç»´æŠ¤å’Œå‡çº§æœåŠ¡ï¼š\n# æ‹‰å–æœ€æ–°çš„åšå®¢æºç git pull  # é‡æ–°åŠ è½½Nginxé…ç½®ä½¿æ›´æ–°ç”Ÿæ•ˆ docker exec lovone-nginx-blog nginx -s reload# å®šæœŸæ£€æŸ¥è¯ä¹¦çŠ¶æ€ï¼Œæ³¨æ„ï¼šè¯¥å‘½ä»¤ä¸ä¼šå®é™…æ›´æ–°è¯ä¹¦ï¼Œå¯ä»¥ç”¨æ¥æ£€æŸ¥è¯ä¹¦ç»­ç­¾æ˜¯å¦æ­£å¸¸å·¥ä½œcertbot renew --dry-run\n\nGood Luck !\n","categories":["hexo","docker","Certbot"],"tags":["hexo","Docker","Certbot","Letâ€˜s Encrypt"]}]